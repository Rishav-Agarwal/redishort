<!DOCTYPE html>
<html>
	<head>
		<title>Url shortener</title>
	</head>
	<body>
		<form id="form_url_short" action="">
			<input id="inp_url" type="url" />
			<input type="submit" />
		</form>

		<div id="result" />

		<script>
			function begin() {
				const inpUrl = document.getElementById("inp_url");
				const formUrlShort = document.getElementById("form_url_short");
				const divResult = document.getElementById("result");

				function shortenUrl(e) {
					e.preventDefault();

					// Get the short url for the input url
					fetch("/api/shorten", {
						method: "post",
						body: JSON.stringify({ url: inpUrl.value }),
					})
						.then((res) => res.json())
						.then((hash) => {
							// generate the shortened url
							const hashUrl =
								"https://" + window.location.host + "/" + hash.shortUrl;

							// Append the short url into the page
							const resultHtml = `<h4>URL: <a href="${inpUrl.value}" target="_blank">${inpUrl.value}</a></h4><h4>Your shortened url is <a href="${hashUrl}" target="_blank">${hashUrl}</a></h4>`;
							divResult.innerHTML = resultHtml;

							// Clear the input
							inpUrl.value = "";
						});
				}

				formUrlShort.addEventListener("submit", shortenUrl);
			}

			document.addEventListener("DOMContentLoaded", begin);
		</script>
	</body>
</html>
